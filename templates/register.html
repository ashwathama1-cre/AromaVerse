{% extends "base.html" %}
{% block title %}Register | Itra Store{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-center vh-100">
  <div class="register-card col-md-6 bg-white shadow rounded-4 p-4">
    <div class="text-center mb-3">
      <i class="bi bi-person-plus-fill text-primary" style="font-size: 2rem;"></i>
      <h3>Create Your Account</h3>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} text-center">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST">
      <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">

      <div class="mb-3">
        <label class="form-label">👤 Username</label>
        <input type="text" name="username" class="form-control" placeholder="Choose a username" required>
      </div>

      <div class="mb-3">
        <label class="form-label">📧 Email</label>
        <input type="email" name="email" class="form-control" placeholder="Enter your email" required>
      </div>

      <div class="mb-3">
        <label for="phone" class="form-label">📱 Phone Number</label>
        <div class="input-group">
          <select class="form-select" id="country_code" name="country_code" style="max-width: 120px;" required>
            <option value="+91" selected>🇮🇳 +91</option>
            <option value="+1">🇺🇸 +1</option>
            <option value="+44">🇬🇧 +44</option>
            <option value="+61">🇦🇺 +61</option>
            <option value="+81">🇯🇵 +81</option>
            <option value="+971">🇦🇪 +971</option>
            <option value="+880">🇧🇩 +880</option>
            <option value="+92">🇵🇰 +92</option>
          </select>
          <input type="text" class="form-control" id="phone" name="phone" placeholder="Enter phone number" required>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">🔑 Password</label>
        <div class="input-group">
          <input type="password" name="password" class="form-control" placeholder="Create a password" id="passwordField" required>
          <button type="button" class="btn btn-outline-secondary" onclick="togglePassword()">👁️</button>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">🔁 Confirm Password</label>
        <input type="password" name="confirm_password" class="form-control" placeholder="Confirm password" required>
      </div>

      <div class="mb-3">
        <label class="form-label">🔍 Verify using</label>
        <select class="form-select" name="otp_method" required>
          <option value="email">Email</option>
          <option value="phone">Phone</option>
        </select>
      </div>

      <div class="mb-3 d-grid">
        <button type="submit" name="send_otp" value="1" class="btn btn-warning" id="sendOtpBtn">📩 Send OTP</button>
      </div>

      {% if show_otp %}
      <div class="mb-3">
        <label class="form-label">🧾 Enter OTP</label>
        <input type="text" name="otp" class="form-control" placeholder="Enter the OTP sent" required>
        <div class="text-muted mt-1">
          ⏳ Time remaining: <span id="otpTimer">02:00</span>
        </div>
      </div>
      {% endif %}

      <button type="submit" class="btn btn-success w-100">✅ Register</button>
    </form>

    <div class="text-center mt-3">
      <p>Already have an account? <a href="{{ url_for('login') }}">🔓 Login</a></p>
    </div>
  </div>
</div>

<script>
function togglePassword() {
  const passField = document.getElementById("passwordField");
  passField.type = (passField.type === "password") ? "text" : "password";
}

{% if show_otp %}
let totalSeconds = 120;
const timerElement = document.getElementById("otpTimer");
const sendBtn = document.getElementById("sendOtpBtn");
sendBtn.disabled = true;

const timer = setInterval(() => {
  const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
  const seconds = String(totalSeconds % 60).padStart(2, '0');
  timerElement.textContent = `${minutes}:${seconds}`;
  totalSeconds--;

  if (totalSeconds < 0) {
    clearInterval(timer);
    timerElement.textContent = "Expired ⛔";
    sendBtn.disabled = false;
  }
}, 1000);
{% endif %}
</script>
{% endblock %}
