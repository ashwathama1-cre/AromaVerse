{% extends "base.html" %}

{% block title %}Admin Dashboard | AromaVerse{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">üìä Admin Dashboard</h2>

  <!-- Summary Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-start border-success border-4">
        <div class="card-body">
          <h6>Total Revenue</h6>
          <p class="text-success fw-bold">‚Çπ{{ "{:,.2f}".format(total_revenue) }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-start border-primary border-4">
        <div class="card-body">
          <h6>Total Products</h6>
          <p class="fw-bold">{{ total_products }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-start border-warning border-4">
        <div class="card-body">
          <h6>Total Quantity Sold</h6>
          <p class="fw-bold">{{ total_sold }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-start border-info border-4">
        <div class="card-body">
          <h6>Total Sellers</h6>
          <p class="fw-bold">{{ total_sellers }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Extra Stats & Actions -->
  <div class="row row-cols-1 row-cols-md-3 g-4 mb-4">
    <div class="col">
      <div class="card border-start border-primary border-4 shadow-sm">
        <div class="card-body">
          <h6>Total Products Left</h6>
          <p class="fw-bold text-primary">{{ total_unsold }}</p>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card border-start border-success border-4 shadow-sm">
        <div class="card-body">
          <h6>Admin Commission Earned</h6>
          <p class="fw-bold text-success">‚Çπ{{ commission }}</p>
        </div>
      </div>
    </div>

    <div class="col">
      <a href="/sales_history" class="btn btn-outline-info w-100 mt-3">üïí View Sale History</a>
      <a href="/admin_charts" class="btn btn-outline-primary w-100 mt-2">üìä Seller Comparison</a>
      <a href="/manage_sellers" class="btn btn-outline-dark w-100 mt-2">üë§ Manage Sellers</a>
      <a href="/sell" class="btn btn-outline-success w-100 mt-2">‚ûï Add Product</a>
      <a href="/promote_list" class="btn btn-outline-warning w-100 mt-2">üîÅ Promote Buyer</a>
    </div>
  </div>

  <!-- Pie Chart -->
  <div class="card mb-4">
    <div class="card-header">
      üìà Product Type Distribution
    </div>
    <div class="card-body">
      <div class="ratio ratio-1x1">
        <canvas id="productChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Seller Table -->
  <div class="card">
    <div class="card-header">
      üë§ Sellers Overview
    </div>
    <div class="card-body table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Seller</th>
            <th>Email</th>
            <th>Total Products</th>
          </tr>
        </thead>
        <tbody>
          {% for seller in seller_data %}
          <tr>
            <td>{{ seller.seller }}</td>
            <td>{{ seller.email }}</td>
            <td>{{ seller.product_count or 0 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Chart Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('productChart').getContext('2d');
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: {{ chart_labels | safe }},
      datasets: [{
        label: 'Product Count',
        data: {{ chart_data | safe }},
        backgroundColor: [
          '#4CAF50', '#2196F3', '#FFC107', '#FF5722', '#9C27B0', '#00BCD4'
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'right'
        }
      }
    }
  });
</script>
{% endblock %}
