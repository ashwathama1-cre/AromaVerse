{% extends "base.html" %}

{% block title %}Admin Dashboard | AromaVerse{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">ğŸ“Š Admin Dashboard</h2>

  <!-- Summary Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-start border-success border-4">
        <div class="card-body">
          <h6>Total Revenue</h6>
          <p class="text-success fw-bold">â‚¹{{ "{:,.2f}".format(total_revenue) }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-start border-primary border-4">
        <div class="card-body">
          <h6>Total Products</h6>
          <p class="fw-bold">{{ total_products }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-start border-warning border-4">
        <div class="card-body">
          <h6>Total Quantity Sold</h6>
          <p class="fw-bold">{{ total_sold }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-start border-info border-4">
        <div class="card-body">
          <h6>Total Sellers</h6>
          <p class="fw-bold">{{ total_sellers }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Extra Stats & Actions -->
  <div class="row row-cols-1 row-cols-md-3 g-4 mb-4">
    <div class="col">
      <div class="card border-start border-primary border-4 shadow-sm">
        <div class="card-body">
          <h6>Total Products Left</h6>
          <p class="fw-bold text-primary">{{ total_unsold }}</p>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card border-start border-success border-4 shadow-sm">
        <div class="card-body">
          <h6>Admin Commission Earned</h6>
          <p class="fw-bold text-success">â‚¹{{ commission }}</p>
        </div>
      </div>
    </div>

    <div class="col d-flex flex-column gap-2">
      <a href="/sales_history" class="btn btn-outline-info">ğŸ•’ View Sale History</a>
      <a href="/admin_charts" class="btn btn-outline-primary">ğŸ“Š Seller Comparison</a>
      <a href="/manage_sellers" class="btn btn-outline-dark">ğŸ‘¤ Manage Sellers</a>
      <a href="/sell" class="btn btn-outline-success">â• Add Product</a>
      <a href="/promote_list" class="btn btn-outline-warning">ğŸ” Promote Buyer</a>
      <a href="/admin/product_stats" class="btn btn-outline-secondary">ğŸ“‹ View Product Stats</a>
      <a href="/admin/products_table" class="btn btn-outline-secondary">ğŸ–¼ï¸ View All Products</a>
      <a href="/change_password" class="btn btn-outline-danger">ğŸ” Change Password</a>
      <a href="/admin/change_name" class="btn btn-outline-secondary">âœï¸ Change Name</a>
    </div>
  </div>

  <!-- Chart Section -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center gap-2">
        ğŸ“Š Product Distribution Chart
        <label for="chartTypeSelector" class="me-2">Chart Type:</label>
        <select id="chartTypeSelector" class="form-select w-auto">
          <option value="">-- Choose Chart --</option>
          <option value="pie">Pie Chart</option>
          <option value="bar">Bar Chart</option>
          <option value="doughnut">Doughnut Chart</option>
        </select>
      </div>
    </div>
    <div class="card-body">
      <div id="chartContainer" class="ratio ratio-1x1 d-none">
        <canvas id="productChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Seller Table -->
  <div class="card">
    <div class="card-header">
      ğŸ‘¤ Sellers Overview
    </div>
    <div class="card-body table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Seller</th>
            <th>Email</th>
            <th>Total Products</th>
          </tr>
        </thead>
        <tbody>
          {% for seller in seller_data %}
          <tr>
            <td>{{ seller.seller }}</td>
            <td>{{ seller.email }}</td>
            <td>{{ seller.product_count or 0 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Chart Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let chart;
  const ctx = document.getElementById('productChart').getContext('2d');
  const labels = {{ chart_labels | safe }};
  const data = {{ chart_data | safe }};

  const chartTypeSelector = document.getElementById('chartTypeSelector');
  const chartContainer = document.getElementById('chartContainer');

  chartTypeSelector.addEventListener('change', function () {
    if (chart) chart.destroy();

    const selectedType = this.value;
    if (!selectedType) {
      chartContainer.classList.add("d-none");
      return;
    }

    chartContainer.classList.remove("d-none");

    chart = new Chart(ctx, {
      type: selectedType,
      data: {
        labels: labels,
        datasets: [{
          label: 'Product Count',
          data: data,
          backgroundColor: [
            '#4CAF50', '#2196F3', '#FFC107', '#FF5722',
            '#9C27B0', '#00BCD4', '#E91E63', '#3F51B5', '#795548'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: selectedType === 'bar' ? 'top' : 'right'
          }
        }
      }
    });
  });
</script>
{% endblock %}
