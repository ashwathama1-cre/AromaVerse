{% extends "base.html" %}

{% block title %}Seller Dashboard | Itra Store{% endblock %}

{% block content %}
<style>
  .product-img {
    height: 80px;
    width: 80px;
    object-fit: cover;
  }
</style>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4 mb-4">
  <a class="navbar-brand" href="#">üå∏ Seller Dashboard</a>
  <div class="ms-auto">
    <ul class="navbar-nav">
      <li class="nav-item dropdown me-4">
        <a class="nav-link dropdown-toggle" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          üîî Notifications <span class="badge bg-danger">{{ notifications|length }}</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationDropdown">
          {% if notifications %}
            {% for note in notifications %}
              <li><a class="dropdown-item" href="#">{{ note }}</a></li>
            {% endfor %}
          {% else %}
            <li><span class="dropdown-item">No notifications</span></li>
          {% endif %}
        </ul>
      </li>
      <li class="nav-item"><a class="nav-link" href="/logout">üö™ Logout</a></li>
    </ul>
  </div>
</nav>

<div class="container">

  <h3 class="mb-3">‚ûï Add New Product</h3>
  <div class="card mb-5">
    <div class="card-body">
      <form action="/add_product" method="POST" enctype="multipart/form-data">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="name" class="form-label">Product Name</label>
            <input type="text" class="form-control" name="name" required>
          </div>
          <div class="col-md-6">
            <label for="type" class="form-label">Type</label>
            <input type="text" class="form-control" name="type" required>
          </div>
          <div class="col-md-4">
            <label for="price" class="form-label">Price (‚Çπ)</label>
            <input type="number" step="0.01" class="form-control" name="price" required>
          </div>
          <div class="col-md-4">
            <label for="quantity" class="form-label">Quantity</label>
            <input type="number" class="form-control" name="quantity" required>
          </div>
          <div class="col-md-4">
            <label for="unit" class="form-label">Unit</label>
            <select class="form-select" name="unit" required>
              <option value="ml">ml</option>
              <option value="gm">gm</option>
              <option value="bottle">bottle</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="image" class="form-label">Product Image</label>
            <input type="file" class="form-control" name="image" accept="image/*" required>
          </div>
          <div class="col-md-6">
            <label for="description" class="form-label">Description (optional)</label>
            <textarea class="form-control" name="description" rows="2"></textarea>
          </div>
        </div>
        <button type="submit" class="btn btn-success mt-4 w-100">‚úÖ Submit Product</button>
      </form>
    </div>
  </div>

  <h3 class="mb-3">üì¶ Your Products</h3>

  {% if products %}
    <div class="table-responsive">
      <table class="table table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Type</th>
            <th>Price</th>
            <th>Unit</th>
            <th>Available Qty</th>
            <th>Sold</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for p in products %}
          <tr>
            <td><img src="{{ url_for('static', filename='uploads/' + p.image) }}" class="product-img" alt="{{ p.name }}"></td>
            <td>{{ p.name }}</td>
            <td>{{ p.type }}</td>
            <td>‚Çπ{{ p.price }}</td>
            <td>{{ p.unit }}</td>
            <td>{{ p.quantity }}</td>
            <td>{{ p.sold }}</td>
            <td>
              <a href="/edit_product/{{ p.id }}" class="btn btn-sm btn-warning" title="Edit Product">‚úèÔ∏è</a>
              <button class="btn btn-sm btn-danger" onclick="confirmDelete('{{ p.id }}')" title="Delete Product">üóëÔ∏è</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">You have not listed any products yet.</div>
  {% endif %}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Delete Confirmation</h5></div>
      <div class="modal-body">Are you sure you want to delete this product?</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a id="deleteLink" class="btn btn-danger" href="#">Delete</a>
      </div>
    </div>
  </div>
</div>

<script>
  function confirmDelete(productId) {
    const deleteLink = document.getElementById("deleteLink");
    deleteLink.href = "/delete_product/" + productId;
    var deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
    deleteModal.show();
  }

  {% if success %}
    Swal.fire({
      icon: 'success',
      title: '{{ success }}',
      showConfirmButton: false,
      timer: 2000
    });
  {% endif %}
</script>
{% endblock %}
