{% extends "base.html" %}
{% block title %}Verify OTP | AromaVerse{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="card mx-auto shadow-lg" style="max-width: 500px;">
    <div class="card-body">
      <h4 class="text-center mb-4">üîç Verify OTP</h4>

      <form id="verifyForm">
        <div class="mb-3">
          <label class="form-label">Enter OTP</label>
          <input type="text" class="form-control" id="otp" placeholder="Enter the OTP" required>
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-success">‚úÖ Verify</button>
        </div>
      </form>

      <div id="verifyResult" class="mt-4 text-center"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById("verifyForm").addEventListener("submit", function (e) {
  e.preventDefault();

  const otp = document.getElementById("otp").value.trim();

  fetch("/verify_otp", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ otp }),
  })
    .then((res) => res.json())
    .then((data) => {
      const resultDiv = document.getElementById("verifyResult");
      if (data.status === "success") {
        resultDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
        setTimeout(() => window.location.href = "/", 1500);  // Redirect on success
      } else {
        resultDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
      }
    })
    .catch((err) => {
      document.getElementById("verifyResult").innerHTML = `<div class="alert alert-danger">Error verifying OTP.</div>`;
    });
});
</script>
{% endblock %}
